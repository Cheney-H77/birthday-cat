<!doctype html>
<html lang="zh-CN">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>ğŸ å½©è›‹æˆ¿é—´</title>
<style>
  :root{--pink:#ff5c8a;--tea:#d4b073;--muted:#7a7a7a}
  html,body{margin:0}
  body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#fff9f3,#fff);color:#222}
  .wrap{max-width:860px;margin:0 auto;padding:22px}
  .card{background:#fff;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:22px;margin-bottom:16px}
  h1{margin:8px 0 6px;font-weight:700}
  .center{text-align:center}
  .btn{padding:12px 16px;border-radius:999px;background:var(--pink);color:#fff;border:none;font-weight:700}
  .btn:active{transform:scale(.95)}
  .muted{color:var(--muted)} .row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

  /* é•¿æŒ‰è¿›åº¦ç¯ */
  .hold{display:flex;flex-direction:column;align-items:center;gap:10px}
  .ring{width:80px;height:80px;border-radius:50%;background:
    conic-gradient(var(--pink) 0deg, #ffd3e1 0deg);
    display:grid;place-items:center}
  .ring span{background:#fff9f3;border-radius:50%;width:62px;height:62px;display:grid;place-items:center;font-weight:700}
  .hidden{display:none}

  /* è½¬ç›˜ï¼ˆ5 æ‰‡åŒºï¼‰ */
  .wheelWrap{display:grid;place-items:center}
  .wheel{width:min(90vw,340px);height:min(90vw,340px);border-radius:50%;border:10px solid #f2e4c8;position:relative;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.08)}
  .slice{position:absolute;inset:0;clip-path:polygon(50% 50%, 0 0, 100% 0);display:flex;align-items:flex-start;justify-content:center;padding-top:24px;font-weight:700}
  /* 5 ç­‰åˆ†ï¼Œæ¯ä¸ª 72Â° */
  .slice:nth-child(1){transform:rotate(0deg);background:#ffe5ec}
  .slice:nth-child(2){transform:rotate(72deg);background:#fff3d6}
  .slice:nth-child(3){transform:rotate(144deg);background:#e7f7f1}
  .slice:nth-child(4){transform:rotate(216deg);background:#ffe5ec}
  .slice:nth-child(5){transform:rotate(288deg);background:#fff3d6}
  .pointer{width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:24px solid var(--tea);margin:10px auto}
  .spinBtn{margin-top:10px}
  .disabled{opacity:.5;pointer-events:none}

  /* ç»“æœå¼¹å±‚ï¼ˆä¿ç•™ç»“æ„ï¼Œå½“å‰ä¸ä½¿ç”¨å…”å­å¥–ï¼‰ */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;padding:16px}
  .modal.show{display:flex}
  .inner{background:#fff;border-radius:18px;max-width:480px;width:100%;padding:20px;text-align:center}
  .inner img{max-width:100%;border-radius:12px;box-shadow:0 6px 16px rgba(0,0,0,.12)}
</style>

<div class="wrap">
  <div class="card center">
    <div class="pointer"></div>
    <h1>å½©è›‹æˆ¿é—´ ğŸˆ</h1>

    <!-- é•¿æŒ‰è§£é”ï¼ˆå¸¦è¿›åº¦ç¯ï¼‰ -->
    <div id="locker" class="hold">
      <div class="ring" id="ring"><span id="ringText">2.0</span></div>
      <button class="btn" id="holdBtn">æŒ‰ä½ 2 ç§’è§£é”</button>
      <div class="muted">ï¼ˆæ¾æ‰‹ä¼šä¸­æ–­å“¦ï¼‰</div>
    </div>

    <!-- è§£é”åçš„è½¬ç›˜ -->
    <div id="wheelArea" class="wheelWrap hidden">
      <div class="wheel" id="wheel">
        <div class="slice">å†æ¥ä¸€æ¬¡</div>
        <div class="slice">ä¸€æ¯å¥¶èŒ¶</div>
        <div class="slice">å°çŒ«ç©å¶</div>
        <div class="slice">å¯¹æˆ‘è¯´ï¼šæˆ‘å¥½å¼€å¿ƒï¼</div>
        <div class="slice">ç»™ç³–è±†æ‰¾ä¸€ä¸ªå°ç©ä¼´</div>
      </div>
      <div class="row">
        <button class="btn spinBtn" id="spinBtn">å¼€å§‹è½¬</button>
      </div>
      <div class="muted" id="chanceText" style="margin-top:8px">å‰©ä½™æœºä¼šï¼š2/2</div>
    </div>
  </div>
</div>

<!-- é¢„ç•™å¼¹å±‚ï¼ˆå½“å‰æœªç”¨åˆ°å›¾ç‰‡ä¿å­˜ï¼‰ -->
<div class="modal" id="resultModal">
  <div class="inner">
    <h2 id="resultTitle">æŠ½åˆ°å•¦</h2>
    <div class="row" style="margin-top:10px">
      <button class="btn" id="closeResult">å¥½è€¶</button>
    </div>
  </div>
</div>

<script>
  /* ===== é…ç½® / æŒä¹…åŒ–é”® ===== */
  const KEY_UNLOCKED = "bc_locker_unlocked";
  const KEY_SPIN_COUNT = "bc_spin_count";   // å·²è½¬æ¬¡æ•°ï¼ˆ0,1,2ï¼‰
  const MAX_SPINS = 2;

  /* ===== é•¿æŒ‰è§£é”ï¼ˆ2 ç§’ + è¿›åº¦ç¯ï¼‰ ===== */
  const locker = document.getElementById("locker");
  const wheelArea = document.getElementById("wheelArea");
  const holdBtn = document.getElementById("holdBtn");
  const ring = document.getElementById("ring");
  const ringText = document.getElementById("ringText");

  function showWheel(){
    locker.classList.add("hidden");
    wheelArea.classList.remove("hidden");
    updateChanceText();
  }
  if(localStorage.getItem(KEY_UNLOCKED)) showWheel();

  let t=null, start=0, need=2000;
  function updateRing(){
    const elapsed = Date.now()-start;
    const pct = Math.min(elapsed/need, 1);
    const deg = Math.round(pct*360);
    ring.style.background = `conic-gradient(var(--pink) ${deg}deg, #ffd3e1 0deg)`;
    ringText.textContent = ( (need-elapsed)/1000 ).toFixed(1);
  }
  function startHold(){
    start = Date.now();
    updateRing();
    t = setInterval(()=>{
      updateRing();
      if(Date.now()-start >= need){
        clearInterval(t); ringText.textContent="0.0";
        if(navigator.vibrate) navigator.vibrate(40);
        localStorage.setItem(KEY_UNLOCKED,"1");
        showWheel();
      }
    }, 50);
  }
  function cancelHold(){ clearInterval(t); ring.style.background=`conic-gradient(var(--pink) 0deg, #ffd3e1 0deg)`; ringText.textContent="2.0"; }
  ["mousedown","touchstart"].forEach(ev=> holdBtn.addEventListener(ev, startHold));
  ["mouseup","mouseleave","touchend","touchcancel"].forEach(ev=> holdBtn.addEventListener(ev, cancelHold));

  /* ===== è½¬ç›˜ï¼ˆ5 æ‰‡åŒº + Rig ä¸¤æ¬¡ï¼‰ ===== */
  const wheel = document.getElementById("wheel");
  const spinBtn = document.getElementById("spinBtn");
  const chanceText = document.getElementById("chanceText");

  function spinTo(angle, cb){
    wheel.style.transition="transform 2.2s cubic-bezier(.18,.8,.2,1)";
    wheel.style.transform=`rotate(${angle}deg)`;
    wheel.addEventListener("transitionend", function h(){ wheel.removeEventListener("transitionend", h); cb && cb(); }, {once:true});
  }

  function updateChanceText(){
    const used = parseInt(localStorage.getItem(KEY_SPIN_COUNT) || "0", 10);
    const left = Math.max(0, MAX_SPINS - used);
    chanceText.textContent = `å‰©ä½™æœºä¼šï¼š${left}/${MAX_SPINS}`;
    if(left===0){ spinBtn.classList.add("disabled"); spinBtn.textContent="æœºä¼šå·²ç”¨å®Œ"; }
  }

  // 5 ç­‰åˆ†ï¼Œæ¯æ‰‡åŒº 72Â°ï¼›æŒ‡é’ˆåœ¨é¡¶éƒ¨ï¼Œæ‰‡åŒºä¸­å¿ƒåˆ†åˆ«ä¸ºï¼š
  // 1: 36Â°, 2:108Â°, 3:180Â°, 4:252Â°, 5:324Â°
  const sectorCenter = [36,108,180,252,324];
  const prizeName = [
    "å†æ¥ä¸€æ¬¡",
    "ä¸€æ¯å¥¶èŒ¶",
    "å°çŒ«ç©å¶",
    "å¯¹æˆ‘è¯´ï¼šæˆ‘å¥½å¼€å¿ƒï¼",
    "ç»™ç³–è±†æ‰¾ä¸€ä¸ªå°ç©ä¼´"
  ];

  function showResult(name){
    const m = document.getElementById("resultModal");
    document.getElementById("resultTitle").textContent = `æŠ½ä¸­ï¼š${name}`;
    m.classList.add("show");
    if(navigator.vibrate) navigator.vibrate(40);
  }
  document.getElementById("closeResult").addEventListener("click", ()=> {
    document.getElementById("resultModal").classList.remove("show");
  });
  document.getElementById("resultModal").addEventListener("click", e=>{
    if(e.target.id==="resultModal") e.currentTarget.classList.remove("show");
  });

  spinBtn.addEventListener("click", ()=>{
    let count = parseInt(localStorage.getItem(KEY_SPIN_COUNT) || "0", 10);
    if(count >= MAX_SPINS){ updateChanceText(); return; }

    const base = 360*4; // å¤šè½¬å‡ åœˆæ›´ä¸æ»‘
    if(count === 0){
      // ç¬¬ä¸€æ¬¡ï¼šç»™ç³–è±†æ‰¾ä¸€ä¸ªå°ç©ä¼´ï¼ˆç¬¬ 5 æ‰‡åŒºï¼š324Â°ï¼‰
      spinTo(base + sectorCenter[4], ()=>{
        showResult(prizeName[4]);
        count = 1; localStorage.setItem(KEY_SPIN_COUNT, String(count));
        updateChanceText();
      });
    } else if(count === 1){
      // ç¬¬äºŒæ¬¡ï¼šå¯¹æˆ‘è¯´ï¼šæˆ‘å¥½å¼€å¿ƒï¼ï¼ˆç¬¬ 4 æ‰‡åŒºï¼š252Â°ï¼‰
      spinTo(base + sectorCenter[3], ()=>{
        showResult(prizeName[3]);
        count = 2; localStorage.setItem(KEY_SPIN_COUNT, String(count));
        updateChanceText();
      });
    }
  });
</script>
</html>


