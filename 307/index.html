<!doctype html>
<html lang="zh-CN">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>ğŸ å½©è›‹æˆ¿é—´</title>
<style>
  :root{--pink:#ff5c8a;--tea:#d4b073;--muted:#7a7a7a}
  html,body{margin:0}
  body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#fff9f3,#fff);color:#222}
  .wrap{max-width:860px;margin:0 auto;padding:22px}
  .card{background:#fff;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:22px;margin-bottom:16px}
  h1{margin:8px 0 6px;font-weight:700}
  .center{text-align:center}
  .btn{padding:12px 16px;border-radius:999px;background:var(--pink);color:#fff;border:none;font-weight:700}
  .btn:active{transform:scale(.95)}
  .muted{color:var(--muted)} .row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

  /* é•¿æŒ‰è¿›åº¦ç¯ */
  .hold{display:flex;flex-direction:column;align-items:center;gap:10px}
  .ring{width:80px;height:80px;border-radius:50%;background:
    conic-gradient(var(--pink) 0deg, #ffd3e1 0deg);
    display:grid;place-items:center}
  .ring span{background:#fff9f3;border-radius:50%;width:62px;height:62px;display:grid;place-items:center;font-weight:700}
  .hidden{display:none}

  /* è½¬ç›˜ï¼ˆ5 æ‰‡åŒºï¼‰ */
  .wheelWrap{display:grid;place-items:center}
  .wheel{
    width:min(90vw,340px);height:min(90vw,340px);
    border-radius:50%;border:10px solid #f2e4c8;position:relative;overflow:hidden;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
    transform:rotate(0deg);               /* å…³é”®ï¼šåˆå§‹ transformï¼Œä¾¿äºè¿‡æ¸¡è§¦å‘ */
    will-change:transform;                /* å…³é”®ï¼šæç¤ºæµè§ˆå™¨ä¼˜åŒ– */
  }
  .slice{position:absolute;inset:0;clip-path:polygon(50% 50%, 0 0, 100% 0);display:flex;align-items:flex-start;justify-content:center;padding-top:24px;font-weight:700}
  /* 5 ç­‰åˆ†ï¼Œæ¯ä¸ª 72Â° */
  .slice:nth-child(1){transform:rotate(0deg);background:#ffe5ec}
  .slice:nth-child(2){transform:rotate(72deg);background:#fff3d6}
  .slice:nth-child(3){transform:rotate(144deg);background:#e7f7f1}
  .slice:nth-child(4){transform:rotate(216deg);background:#ffe5ec}
  .slice:nth-child(5){transform:rotate(288deg);background:#fff3d6}
  .pointer{width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:24px solid var(--tea);margin:10px auto}
  .spinBtn{margin-top:10px}
  .disabled{opacity:.5;pointer-events:none}

  /* ç»“æœå¼¹å±‚ */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;padding:16px}
  .modal.show{display:flex}
  .inner{background:#fff;border-radius:18px;max-width:480px;width:100%;padding:20px;text-align:center}
</style>

<div class="wrap">
  <div class="card center">
    <div class="pointer"></div>
    <h1>å½©è›‹æˆ¿é—´ ğŸˆ</h1>

    <!-- é•¿æŒ‰è§£é”ï¼ˆå¸¦è¿›åº¦ç¯ï¼‰ -->
    <div id="locker" class="hold">
      <div class="ring" id="ring"><span id="ringText">2.0</span></div>
      <button class="btn" id="holdBtn">æŒ‰ä½ 2 ç§’è§£é”</button>
      <div class="muted">ï¼ˆæ¾æ‰‹ä¼šä¸­æ–­å“¦ï¼‰</div>
    </div>

    <!-- è§£é”åçš„è½¬ç›˜ -->
    <div id="wheelArea" class="wheelWrap hidden">
      <div class="wheel" id="wheel">
        <div class="slice">å†æ¥ä¸€æ¬¡</div>
        <div class="slice">ä¸€æ¯å¥¶èŒ¶</div>
        <div class="slice">å°çŒ«ç©å¶</div>
        <div class="slice">å¯¹æˆ‘è¯´ï¼šæˆ‘å¥½å¼€å¿ƒï¼</div>
        <div class="slice">ç»™ç³–è±†æ‰¾ä¸€ä¸ªå°ç©ä¼´</div>
      </div>
      <div class="row">
        <button class="btn spinBtn" id="spinBtn">å¼€å§‹è½¬</button>
      </div>
      <div class="muted" id="chanceText" style="margin-top:8px">å‰©ä½™æœºä¼šï¼š2/2</div>
      <div class="muted" id="resultLine" style="margin-top:6px"></div>
    </div>
  </div>
</div>

<!-- ç»“æœå¼¹å±‚ -->
<div class="modal" id="resultModal">
  <div class="inner">
    <h2 id="resultTitle">æŠ½åˆ°å•¦</h2>
    <div class="row" style="margin-top:10px">
      <button class="btn" id="closeResult">å¥½è€¶</button>
    </div>
  </div>
</div>

<script>
  /* ===== æŒä¹…åŒ–é”® ===== */
  const KEY_UNLOCKED = "bc_locker_unlocked";
  const KEY_SPIN_COUNT = "bc_spin_count";   // å·²è½¬æ¬¡æ•°ï¼ˆ0,1,2ï¼‰
  const KEY_LAST_PRIZE = "bc_last_prize";
  const MAX_SPINS = 2;

  const locker = document.getElementById("locker");
  const wheelArea = document.getElementById("wheelArea");
  const holdBtn = document.getElementById("holdBtn");
  const ring = document.getElementById("ring");
  const ringText = document.getElementById("ringText");

  const wheel = document.getElementById("wheel");
  const spinBtn = document.getElementById("spinBtn");
  const chanceText = document.getElementById("chanceText");
  const resultLine = document.getElementById("resultLine");

  const resultModal = document.getElementById("resultModal");
  const resultTitle = document.getElementById("resultTitle");
  document.getElementById("closeResult").addEventListener("click", ()=> resultModal.classList.remove("show"));
  resultModal.addEventListener("click", e=>{ if(e.target===resultModal) resultModal.classList.remove("show"); });

  /* ---------- æ¢å¤çŠ¶æ€ï¼ˆä¸é‡ç½®ï¼‰ ---------- */
  function getCount(){
    try{ return parseInt(localStorage.getItem(KEY_SPIN_COUNT) || "0", 10) }catch{ return 0 }
  }
  function setCount(n){
    try{ localStorage.setItem(KEY_SPIN_COUNT, String(n)); }catch{}
  }
  function updateChanceText(){
    const used = getCount();
    const left = Math.max(0, MAX_SPINS - used);
    chanceText.textContent = `å‰©ä½™æœºä¼šï¼š${left}/${MAX_SPINS}`;
    const last = localStorage.getItem(KEY_LAST_PRIZE) || "";
    resultLine.textContent = last ? `ä¸Šæ¬¡ç»“æœï¼š${last}` : "";
    if(left===0){ spinBtn.classList.add("disabled"); spinBtn.textContent="æœºä¼šå·²ç”¨å®Œ"; }
    else { spinBtn.classList.remove("disabled"); spinBtn.textContent="å¼€å§‹è½¬"; }
  }
  function showWheel(){
    locker.classList.add("hidden");
    wheelArea.classList.remove("hidden");
    updateChanceText();
  }
  if(localStorage.getItem(KEY_UNLOCKED)) showWheel();

  /* ---------- é•¿æŒ‰ 2 ç§’è§£é” ---------- */
  let t=null, start=0, need=2000;
  function updateRing(){
    const elapsed = Date.now()-start;
    const pct = Math.min(elapsed/need, 1);
    const deg = Math.round(pct*360);
    ring.style.background = `conic-gradient(var(--pink) ${deg}deg, #ffd3e1 0deg)`;
    ringText.textContent = ((need-elapsed)/1000).toFixed(1);
  }
  function startHold(){
    start = Date.now(); updateRing();
    t = setInterval(()=>{
      updateRing();
      if(Date.now()-start >= need){
        clearInterval(t); ringText.textContent="0.0";
        if(navigator.vibrate) navigator.vibrate(40);
        localStorage.setItem(KEY_UNLOCKED,"1");
        showWheel();
      }
    }, 50);
  }
  function cancelHold(){ clearInterval(t); ring.style.background=`conic-gradient(var(--pink) 0deg, #ffd3e1 0deg)`; ringText.textContent="2.0"; }
  ["mousedown","touchstart"].forEach(ev=> holdBtn.addEventListener(ev, startHold));
  ["mouseup","mouseleave","touchend","touchcancel"].forEach(ev=> holdBtn.addEventListener(ev, cancelHold));

  /* ---------- è½¬ç›˜ï¼š5 æ‰‡åŒº + å›ºå®šä¸¤æ¬¡ç»“æœ ---------- */
  // 5 ç­‰åˆ†ï¼šä¸­å¿ƒè§’åº¦ [36,108,180,252,324]
  const sectorCenter = [36,108,180,252,324];
  const prizeName = [
    "å†æ¥ä¸€æ¬¡",
    "ä¸€æ¯å¥¶èŒ¶",
    "å°çŒ«ç©å¶",
    "å¯¹æˆ‘è¯´ï¼šæˆ‘å¥½å¼€å¿ƒï¼",
    "ç»™ç³–è±†æ‰¾ä¸€ä¸ªå°ç©ä¼´"
  ];

  // å…³é”®ï¼šç¨³å®šè§¦å‘è¿‡æ¸¡çš„æ—‹è½¬å‡½æ•°ï¼ˆå¼ºåˆ¶é‡ç»˜ + rAFï¼‰
  function spinTo(targetAngle, cb){
    const startAngle = wheel._angle || 0;         // è®°ä½ä¸Šæ¬¡è§’åº¦ï¼ˆè§†è§‰è¿ç»­ï¼‰
    wheel.style.transition = "none";
    wheel.style.transform  = `rotate(${startAngle}deg)`; // å›åˆ°å½“å‰è§’åº¦
    void wheel.offsetWidth;                       // å¼ºåˆ¶é‡ç»˜
    requestAnimationFrame(()=>{
      wheel.style.transition = "transform 2.2s cubic-bezier(.18,.8,.2,1)";
      wheel.style.transform  = `rotate(${targetAngle}deg)`;
      wheel.addEventListener("transitionend", function h(){
        wheel.removeEventListener("transitionend", h);
        wheel._angle = targetAngle % 360;        // å­˜ä¸€ä¸‹å½“å‰è§’åº¦
        cb && cb();
      }, {once:true});
    });
  }

  function showResult(name){
    localStorage.setItem(KEY_LAST_PRIZE, name);
    resultTitle.textContent = `æŠ½ä¸­ï¼š${name}`;
    resultModal.classList.add("show");
    updateChanceText();
    if(navigator.vibrate) navigator.vibrate(40);
  }

  spinBtn.addEventListener("click", ()=>{
    const used = getCount();
    if(used >= MAX_SPINS) { updateChanceText(); return; }

    const base = 360*4; // å¤šè½¬å‡ åœˆæ›´ä¸æ»‘
    if(used === 0){
      // ç¬¬ä¸€æ¬¡ï¼šç»™ç³–è±†æ‰¾ä¸€ä¸ªå°ç©ä¼´ï¼ˆç¬¬ 5 æ‰‡åŒºï¼‰
      spinTo(base + sectorCenter[4], ()=>{
        showResult(prizeName[4]);
        setCount(1);
      });
    }else if(used === 1){
      // ç¬¬äºŒæ¬¡ï¼šå¯¹æˆ‘è¯´ï¼šæˆ‘å¥½å¼€å¿ƒï¼ï¼ˆç¬¬ 4 æ‰‡åŒºï¼‰
      spinTo(base + sectorCenter[3], ()=>{
        showResult(prizeName[3]);
        setCount(2);
      });
    }
  });

  // åˆæ¬¡è¿›å…¥ï¼ˆæœªè§£é”æ—¶ä¸æ˜¾ç¤ºè½¬ç›˜ï¼›å·²è§£é”åˆ™ç›´æ¥æŒ‰æœ¬åœ°çŠ¶æ€æ¸²æŸ“ï¼‰
  updateChanceText();
</script>
</html>



