<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>ğŸ æƒŠå–œæˆ¿é—´</title>
<style>
  /* ===== 1. å…¨å±€é…ç½® (ä¸ä¸»é¡µç»Ÿä¸€) ===== */
  :root{
    --tea: #d4b073; 
    --pink: #ff5c8a; 
    --cream: #fff9f3;
    --glass: rgba(255, 255, 255, 0.75);
    --glass-border: rgba(255, 255, 255, 0.8);
    --shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
  }
  
  *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
  html,body{margin:0; padding:0; height: 100%; overflow: hidden;}
  
  body{
    font-family: -apple-system, "SF Pro Text", "å¾®è½¯é›…é»‘", sans-serif;
    background: #fff9f3;
    color: #4a4a4a;
  }

  /* åŠ¨æ€èƒŒæ™¯å…‰æ™• */
  .ambient-light {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: -1; pointer-events: none;
  }
  .orb {
    position: absolute; border-radius: 50%;
    filter: blur(50px); opacity: 0.6;
    animation: float 15s infinite ease-in-out alternate;
  }
  .orb-1 { width: 320px; height: 320px; background: #ffe5ec; top: -60px; left: -60px; }
  .orb-2 { width: 280px; height: 280px; background: #fff3d6; bottom: -40px; right: -40px; animation-delay: -5s; }
  
  @keyframes float { 0% {transform: translate(0,0)} 100% {transform: translate(30px, 40px)} }

  .wrap {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    min-height: 100vh; padding: 20px;
  }

  /* ===== 2. æ¯›ç»ç’ƒå¡ç‰‡ ===== */
  .card {
    background: var(--glass);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    border-radius: 30px;
    box-shadow: var(--shadow);
    padding: 30px 20px;
    width: 100%; max-width: 420px;
    text-align: center;
    position: relative; overflow: hidden;
    transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
  }
  
  h1 { font-size: 24px; color: #8a6b3f; margin: 0 0 8px; }
  .desc { font-size: 14px; color: #999; margin-bottom: 24px; }

  /* ===== 3. é•¿æŒ‰è§£é” (çŒ«çˆªè“„åŠ›) ===== */
  .locker-area {
    height: 300px; display: flex; flex-direction: column; 
    align-items: center; justify-content: center;
    position: relative;
  }
  
  .paw-btn {
    width: 100px; height: 100px;
    background: #fff; border-radius: 50%;
    box-shadow: 0 8px 25px rgba(255, 92, 138, 0.2);
    display: flex; align-items: center; justify-content: center;
    font-size: 40px; cursor: pointer; position: relative;
    transition: transform 0.2s; z-index: 2; user-select: none;
  }
  .paw-btn:active { transform: scale(0.95); }
  
  /* è“„åŠ›å…‰ç¯ */
  .ring {
    position: absolute; width: 140px; height: 140px;
    border-radius: 50%; border: 4px solid #ffe5ec;
    opacity: 0; transform: scale(0.8);
    pointer-events: none;
  }
  .ring.charging {
    opacity: 1; border-color: var(--pink);
    transition: transform 2s linear;
    transform: scale(1.1); /* è“„åŠ›æ—¶å˜å¤§ */
  }
  
  .hint { margin-top: 20px; font-size: 14px; color: #aaa; transition: opacity 0.3s;}

  /* ===== 4. è½¬ç›˜ (é©¬å¡é¾™é£æ ¼) ===== */
  .wheel-area {
    display: none; /* åˆå§‹éšè— */
    flex-direction: column; align-items: center;
    animation: popUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  @keyframes popUp { from{opacity:0; transform: scale(0.8)} to{opacity:1; transform: scale(1)} }

  .wheel-wrap {
    position: relative; width: 280px; height: 280px;
    margin-bottom: 20px; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.1));
  }
  
  .wheel {
    width: 100%; height: 100%; border-radius: 50%;
    border: 8px solid #fff; overflow: hidden;
    position: relative;
    /* 5ä¸ªæ‰‡åŒºèƒŒæ™¯ï¼šç”¨ conic-gradient å®ç° */
    background: conic-gradient(
      #ffe5ec 0deg 72deg, 
      #fff9f3 72deg 144deg, 
      #ffe5ec 144deg 216deg, 
      #fff9f3 216deg 288deg, 
      #ffe5ec 288deg 360deg
    );
    transform: rotate(0deg); /* æ—‹è½¬ç›®æ ‡ */
    /* è´å¡å°”æ›²çº¿ï¼šå…ˆæ…¢åå¿«å†æ…¢ï¼Œæ¨¡æ‹ŸçœŸå®é˜»åŠ› */
    transition: transform 3s cubic-bezier(0.2, 0.8, 0.2, 1); 
  }

  /* åˆ†å‰²çº¿ */
  .line {
    position: absolute; top: 0; left: 50%; width: 2px; height: 50%;
    background: rgba(255,255,255,0.6); transform-origin: bottom center;
  }

  /* å¥–å“æ–‡å­— */
  .label {
    position: absolute; top: 0; left: 50%; width: 20px; height: 50%;
    transform-origin: bottom center;
    text-align: center; padding-top: 15px;
    font-size: 13px; font-weight: bold; color: #d4b073;
    writing-mode: vertical-rl; /* ç«–æ’æ–‡å­— */
    pointer-events: none;
  }

  /* æŒ‡é’ˆ (çŒ«çˆªå½¢çŠ¶æ¨¡æ‹Ÿ) */
  .pointer {
    position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
    z-index: 10; width: 40px; height: 40px;
    background: #fff; border-radius: 50%;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    display: flex; align-items: center; justify-content: center; font-size: 20px;
  }
  .pointer::after {
    content: ""; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%);
    border-left: 8px solid transparent; border-right: 8px solid transparent;
    border-top: 10px solid #fff;
  }

  .spin-btn {
    background: var(--pink); color: #fff; border: none;
    padding: 12px 32px; border-radius: 99px; font-size: 16px; font-weight: bold;
    box-shadow: 0 8px 20px rgba(255, 92, 138, 0.3);
    transition: transform 0.1s;
  }
  .spin-btn:active { transform: scale(0.95); }
  .spin-btn:disabled { opacity: 0.5; background: #ccc; box-shadow: none; }

  /* ===== 5. å¼¹çª—ä¸ç‰¹æ•ˆ ===== */
  .modal {
    position: fixed; inset: 0; background: rgba(0,0,0,0.4);
    backdrop-filter: blur(5px); z-index: 100;
    display: none; align-items: center; justify-content: center;
  }
  .modal.show { display: flex; animation: fadeIn 0.3s; }
  .modal-inner {
    background: #fff; padding: 30px; border-radius: 24px;
    text-align: center; max-width: 300px; width: 85%;
    box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    transform: scale(0.9); animation: popModal 0.4s cubic-bezier(0.17, 0.67, 0.3, 1.2) forwards;
  }
  @keyframes popModal { to {transform: scale(1)} }
  
  .result-text { font-size: 18px; color: var(--pink); font-weight: bold; margin: 15px 0 20px; line-height: 1.5; }
  .close-btn { 
    background: #f0f0f0; color: #666; padding: 10px 24px; border-radius: 99px; 
    border: none; font-weight: bold; cursor: pointer; 
  }

  .particles { position: fixed; inset: 0; pointer-events: none; z-index: 99; }
</style>
</head>
<body>

<div class="ambient-light">
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
</div>

<div class="wrap">
  <div class="card">
    <h1>ğŸ ç¥ç§˜å½©è›‹</h1>
    <div class="desc" id="statusText">é•¿æŒ‰çŒ«çˆª è§£é™¤å°å°</div>

    <div id="locker" class="locker-area">
      <div class="ring" id="ring"></div>
      <div class="paw-btn" id="holdBtn">ğŸ¾</div>
      <div class="hint">æŒ‰ä½ 2 ç§’è¯•è¯•ï¼Ÿ</div>
    </div>

    <div id="wheelArea" class="wheel-area">
      <div class="wheel-wrap">
        <div class="pointer">ğŸ±</div>
        <div class="wheel" id="wheel">
          <div class="line" style="transform: rotate(72deg)"></div>
          <div class="line" style="transform: rotate(144deg)"></div>
          <div class="line" style="transform: rotate(216deg)"></div>
          <div class="line" style="transform: rotate(288deg)"></div>
          
          <div class="label" style="transform: rotate(36deg)">å†æ¥ä¸€æ¬¡</div>
          <div class="label" style="transform: rotate(108deg)">ä¸€æ¯å¥¶èŒ¶</div>
          <div class="label" style="transform: rotate(180deg)">å°çŒ«ç©å¶</div>
          <div class="label" style="transform: rotate(252deg)">å¯¹æˆ‘è¯´ï¼š<br>æˆ‘å¥½å¼€å¿ƒï¼</div>
          <div class="label" style="transform: rotate(324deg)">ç»™ç³–è±†æ‰¾<br>ä¸€ä¸ªç©ä¼´</div>
        </div>
      </div>
      
      <button class="spin-btn" id="spinBtn">å¼€å§‹è½¬åŠ¨</button>
      <div style="margin-top:15px; font-size:13px; color:#aaa" id="chanceInfo">å‰©ä½™æœºä¼šï¼š2</div>
    </div>
  </div>
</div>

<div class="modal" id="resultModal">
  <div class="modal-inner">
    <div style="font-size:40px">ğŸ‰</div>
    <div class="result-text" id="resultContent">...</div>
    <button class="close-btn" id="closeModal">æ”¶ä¸‹ç¤¼ç‰©</button>
  </div>
</div>

<div class="particles" id="particles"></div>

<audio id="bgm" loop>
  <source src="../assets/bgm.mp3" type="audio/mpeg">
</audio>

<script>
  /* ================= é…ç½® ================= */
  // å¥–å“é…ç½® (å¿…é¡»ä¸ HTML é‡Œçš„é¡ºåºå¯¹åº”)
  // è§’åº¦æ˜¯é¡ºæ—¶é’ˆæ–¹å‘ï¼ŒæŒ‡é’ˆåœ¨æ­£ä¸Šæ–¹ã€‚
  // 0-72: å†æ¥ä¸€æ¬¡
  // 72-144: å¥¶èŒ¶
  // 144-216: ç©å¶
  // 216-288: æˆ‘å¥½å¼€å¿ƒ
  // 288-360: ç»™ç³–è±†æ‰¾ç©ä¼´
  const PRIZES = [
    { text: "å†æ¥ä¸€æ¬¡", min: 0, max: 72 },
    { text: "ä¸€æ¯å¥¶èŒ¶", min: 72, max: 144 },
    { text: "å°çŒ«ç©å¶", min: 144, max: 216 },
    { text: "å¯¹æˆ‘è¯´ï¼šæˆ‘å¥½å¼€å¿ƒï¼", min: 216, max: 288 }, // ç›®æ ‡2 (Index 3)
    { text: "ç»™ç³–è±†æ‰¾ä¸€ä¸ªç©ä¼´", min: 288, max: 360 }    // ç›®æ ‡1 (Index 4)
  ];
  
  // å‰§æœ¬é€»è¾‘ï¼šç¬¬1æ¬¡å¿…ä¸­ Index 4ï¼Œç¬¬2æ¬¡å¿…ä¸­ Index 3
  const SCRIPT = [4, 3]; 

  /* ================= çŠ¶æ€ç®¡ç† (å†…å­˜çº§ï¼Œä¸å­˜ LocalStorage) ================= */
  let isUnlocked = false;
  let spinCount = 0;
  let currentRotation = 0; // è®°å½•å½“å‰è½¬è¿‡çš„è§’åº¦
  
  const locker = document.getElementById('locker');
  const wheelArea = document.getElementById('wheelArea');
  const holdBtn = document.getElementById('holdBtn');
  const ring = document.getElementById('ring');
  const wheel = document.getElementById('wheel');
  const spinBtn = document.getElementById('spinBtn');
  const chanceInfo = document.getElementById('chanceInfo');
  const statusText = document.getElementById('statusText');
  const bgm = document.getElementById('bgm');

  /* ================= 1. è§£é”é€»è¾‘ ================= */
  let holdTimer = null;
  let startTime = 0;
  
  function startHold(e){
    e.preventDefault(); // é˜²æ­¢æ‰‹æœºç«¯é•¿æŒ‰é€‰ä¸­æ–‡æœ¬
    if(isUnlocked) return;
    
    startTime = Date.now();
    holdBtn.style.transform = "scale(0.9)";
    ring.classList.add('charging'); // å¼€å§‹CSSåŠ¨ç”»
    
    // 2ç§’åè§£é”
    holdTimer = setTimeout(() => {
      unlockSuccess();
    }, 2000);
  }

  function cancelHold(){
    if(isUnlocked) return;
    clearTimeout(holdTimer);
    holdBtn.style.transform = "scale(1)";
    ring.classList.remove('charging'); // åŠ¨ç”»å–æ¶ˆ
  }

  function unlockSuccess(){
    isUnlocked = true;
    if(navigator.vibrate) navigator.vibrate([50, 50, 50]);
    
    // æ’­æ”¾éŸ³ä¹ (åˆ©ç”¨ç”¨æˆ·çš„äº¤äº’äº‹ä»¶è§¦å‘)
    bgm.play().catch(()=>{});

    // è§†è§‰åˆ‡æ¢
    locker.style.display = 'none';
    wheelArea.style.display = 'flex';
    statusText.textContent = "è½¬åŠ¨çŒ«çˆª æŠ½å–ç¤¼ç‰©";
    
    // æ’’èŠ±ç‰¹æ•ˆ
    fireConfetti();
  }

  // ç»‘å®šè§¦æ‘¸/é¼ æ ‡äº‹ä»¶
  holdBtn.addEventListener('mousedown', startHold);
  holdBtn.addEventListener('touchstart', startHold);
  
  ['mouseup', 'mouseleave', 'touchend', 'touchcancel'].forEach(ev => {
    holdBtn.addEventListener(ev, cancelHold);
  });

  /* ================= 2. è½¬ç›˜é€»è¾‘ ================= */
  spinBtn.addEventListener('click', () => {
    if(spinCount >= SCRIPT.length) return;
    
    // ç¦ç”¨æŒ‰é’®
    spinBtn.disabled = true;
    spinBtn.textContent = "è½¬åŠ¨ä¸­...";

    // è·å–å‰§æœ¬ç›®æ ‡
    const targetIndex = SCRIPT[spinCount];
    const targetPrize = PRIZES[targetIndex];
    
    // è®¡ç®—è§’åº¦
    // æˆ‘ä»¬éœ€è¦æŒ‡é’ˆæŒ‡åœ¨ [min, max] ä¹‹é—´ã€‚
    // å› ä¸º wheel æ—‹è½¬æ˜¯é¡ºæ—¶é’ˆï¼ŒæŒ‡é’ˆåœ¨æ­£ä¸Šæ–¹(0åº¦)ï¼Œ
    // æ‰€ä»¥è¦è®©æŸä¸ªæ‰‡åŒºè½¬åˆ°æ­£ä¸Šæ–¹ï¼Œéœ€è¦æ—‹è½¬ï¼š 360 - (æ‰‡åŒºä¸­å¿ƒè§’åº¦)
    const centerAngle = (targetPrize.min + targetPrize.max) / 2;
    const rotateAngle = 360 - centerAngle; // ç›®æ ‡ç›¸å¯¹è§’åº¦
    
    // å¤šè½¬ 5 åœˆ (1800åº¦) + ç›®æ ‡è§’åº¦ + åŠ ä¸Šä¹‹å‰çš„ç´¯ç§¯è§’åº¦
    const extraSpins = 360 * 5;
    currentRotation += (extraSpins + rotateAngle - (currentRotation % 360));
    
    // CSS æ—‹è½¬
    wheel.style.transform = `rotate(${currentRotation}deg)`;

    // ç›‘å¬åŠ¨ç”»ç»“æŸ (3s å)
    setTimeout(() => {
      showResult(targetPrize.text);
      spinCount++;
      updateChance();
      spinBtn.disabled = false;
    }, 3000);
  });

  function updateChance(){
    const left = Math.max(0, 2 - spinCount);
    chanceInfo.textContent = `å‰©ä½™æœºä¼šï¼š${left}`;
    if(left === 0){
      spinBtn.textContent = "æœºä¼šç”¨å®Œäº†";
      spinBtn.disabled = true;
    } else {
      spinBtn.textContent = "å¼€å§‹è½¬åŠ¨";
    }
  }

  /* ================= 3. ç»“æœä¸ç‰¹æ•ˆ ================= */
  const modal = document.getElementById('resultModal');
  const resultContent = document.getElementById('resultContent');
  const closeModal = document.getElementById('closeModal');

  function showResult(text){
    resultContent.innerHTML = text; // æ”¯æŒæ¢è¡Œ
    modal.classList.add('show');
    fireConfetti(); // å†æ¬¡æ’’èŠ±
    if(navigator.vibrate) navigator.vibrate(100);
  }

  closeModal.addEventListener('click', () => {
    modal.classList.remove('show');
  });

  // ç²’å­ç³»ç»Ÿ (å¤ç”¨ä¸»é¡µçš„ç®€å•ç‰ˆ)
  function fireConfetti(){
    const colors = ['#ff5c8a', '#d4b073', '#74c0fc', '#a9e34b'];
    const pContainer = document.getElementById('particles');
    
    for(let i=0; i<60; i++){
      const el = document.createElement('div');
      el.style.position = 'fixed';
      el.style.width = '8px'; el.style.height = '12px';
      el.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
      el.style.left = Math.random()*100 + 'vw';
      el.style.top = '-20px';
      el.style.zIndex = '999';
      el.style.borderRadius = '2px';
      
      // éšæœºä¸‹è½åŠ¨ç”»
      const duration = 2 + Math.random() * 2;
      el.style.transition = `top ${duration}s ease-in, transform ${duration}s linear, opacity ${duration}s ease-in`;
      pContainer.appendChild(el);

      // ä¸‹ä¸€å¸§è§¦å‘åŠ¨ç”»
      requestAnimationFrame(() => {
        el.style.top = '110vh';
        el.style.transform = `rotate(${Math.random()*720}deg) translateX(${Math.random()*40-20}px)`;
        el.style.opacity = '0';
      });

      // æ¸…ç†
      setTimeout(() => el.remove(), duration*1000);
    }
  }
</script>
</body>
</html>


